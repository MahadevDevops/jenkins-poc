pipeline {
    agent any
    
    environment {
        TF_VERSION = "0.15.5" // Specify the Terraform version you want to use
        SECRET_FILE = credentials("poc-pem")
       
    }
    
    stages {
        stage('Connect-ec2') {
            steps {
                echo "Get the public ip of ec2"
                sh "terraform init"
                sh """ ssh -tt -i $SECRET_FILE -o StrictHostKeyChecking=no ubuntu@`terraform output -raw ec2_public_IP` << EOF 
                sudo service docker start
                sudo docker run --name nginx -d nginx
                exit
                EOF"""
            }
        }

    }
    

}